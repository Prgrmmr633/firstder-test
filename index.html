{% extends "base.html" %} {% block title %}Index{% endblock %} {% block content %}
<div class="p-4 bg-white shadow-md rounded-lg">
  <label
    class="block text-gray-700 text-4xl font-bold text-center pb-2"
    style="background-clip: text; -webkit-background-clip: text; color: transparent; background-image: linear-gradient(to right, #2563eb, #2dd4bf)"
  >
    Dermafy Now
  </label>
  <label class="block text-gray-700 text-2xl text-center py-4"> Instructions </label>
  <img src="{{ url_for('static', path='/asset/DermaInstruction.png') }}" alt="instructions" class="mx-auto h-72 rounded-lg" />
  <form class="w-full" method="post" enctype="multipart/form-data" action="/image">
    <div class="flex -mx-3 py-1">
      <div class="w-full px-3">
        <div class="flex justify-between">
          <!-- Photo Function Should be Placed Here! -->
          <div class="w-1/2 h-36 flex items-center justify-center cursor-pointer bg-blue-400 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 m-4">
            <video id="video" width="320" height="240" autoplay></video>
            <canvas id="canvas" width="320" height="240" class="hidden"></canvas>
            <button id="snap" class="text-center cursor-pointer text-3xl">Take A Photo</button>
          </div>

          <!-- Upload Image Function -->
          <div class="w-1/2 h-36 flex items-center justify-center cursor-pointer bg-blue-400 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 m-4">
            <label for="uploadImage" class="text-center cursor-pointer text-3xl">
              Upload <br />
              Image
            </label>
            <input class="opacity-0 absolute h-32 cursor-pointer" type="file" id="uploadImage" name="uploadImage" accept="image/*" />
          </div>
        </div>
        <p class="text-gray-600 text-xs italic text-center">Take a Photo or Choose an Image to Submit a Picture</p>

        <!-- Opens webcam function -->
        <script>
          // Get the video and canvas elements
          var video = document.getElementById("video");
          var canvas = document.getElementById("canvas");
          var context = canvas.getContext("2d");

          // Get access to the webcam
          if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true }).then(function (stream) {
              // Set the video source to the webcam stream
              video.srcObject = stream;
              video.play();
            });
          }

          // Add a click event listener to the snap button
          document.getElementById("snap").addEventListener("click", function () {
            // Draw the video frame to the canvas
            context.drawImage(video, 0, 0, 320, 240);
            // Hide the video element and show the canvas
            video.classList.add("hidden");
            canvas.classList.remove("hidden");
          });
        </script>

        <!-- Checkbox for Terms and Services Consent -->
        <div class="flex items-center justify-center mt-4">
          <input type="checkbox" id="termsCheckbox" onchange="enableButtons()" />
          <label for="termsCheckbox" class="ml-2">
            Checking This Box Means You Consent to the <a class="text-blue-600 font-semibold" href="#">Terms</a> and <a class="text-blue-600 font-semibold" href="#">Services</a> of Autoderm.
          </label>
        </div>
      </div>
    </div>
    <div class="md:flex md:items-center justify-center">
      <div class="">
        <!-- Disabled Submit Button Until Checkbox is Checked -->
        <button class="shadow bg-blue-400 rounded-lg hover:bg-blue-600 focus:shadow-outline focus:outline-none text-white font-bold py-2 px-4" type="submit" name="submit" id="submitButton" disabled>
          Submit
        </button>
      </div>
    </div>
  </form>
  <div class="mt-4 text-center">
    <a href="/results" class="bg-gray-400 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">View Past Results</a>
  </div>

  <script>
    function enableButtons() {
      var checkbox = document.getElementById("termsCheckbox");
      var photoButton = document.getElementById("image");
      var uploadButton = document.getElementById("uploadImage");
      var submitButton = document.getElementById("submitButton");

      // Enable/disable buttons based on checkbox state
      // photoButton.disabled = !checkbox.checked;
      // uploadButton.disabled = !checkbox.checked;
      submitButton.disabled = !checkbox.checked;
      window.location.href = "#content";
    }
  </script>
</div>
{% endblock content %}

<!-- Webcam function script -->
<script>
  // Get the video and canvas elements
  var video = document.getElementById("video");
  var canvas = document.getElementById("canvas");
  var context = canvas.getContext("2d");

  // Get access to the webcam
  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia({ video: true }).then(function (stream) {
      // Set the video source to the webcam stream
      video.srcObject = stream;
      video.play();
    });
  }

  // Add a click event listener to the snap button
  document.getElementById("snap").addEventListener("click", function () {
    // Draw the video frame to the canvas
    context.drawImage(video, 0, 0, 320, 240);
  });
</script>
